<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penampil Data GitHub - Debug Mode</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [SAMA DENGAN CSS SEBELUMNYA - TIDAK DIUBAH] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --warna-primer: #24292e;
            --warna-sekunder: #0366d6;
            --warna-aksen: #28a745;
            --bg-terang: #f6f8fa;
            --border: #e1e4e8;
            --teks: #24292e;
            --teks-terang: #586069;
            --bayangan-kartu: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        body {
            background-color: #fafbfc;
            color: var(--teks);
            line-height: 1.6;
        }
        
        .kontainer {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* [SISIPKAN SEMUA CSS DARI SEBELUMNYA DI SINI] */
        /* ... CSS lengkap seperti sebelumnya ... */
        
        /* Style tambahan untuk debug */
        .debug-panel {
            background: white;
            border-radius: 8px;
            box-shadow: var(--bayangan-kartu);
            margin: 20px 0;
            overflow: hidden;
        }
        
        .debug-header {
            background: #6f42c1;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .debug-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .debug-toggle {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e1e4e8;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .data-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-item {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .info-label {
            font-weight: bold;
            color: #6f42c1;
        }
    </style>
</head>
<body>
    <header>
        <div class="kontainer header-konten">
            <div class="logo">
                <i class="fab fa-github"></i>
                <h1>Penampil Data GitHub - Debug Mode</h1>
            </div>
            <a href="https://github.com" class="link-github" target="_blank">
                <i class="fab fa-github"></i>
                <span>Kunjungi GitHub</span>
            </a>
        </div>
    </header>
    
    <main class="konten-utama">
        <div class="kontainer">
            <div class="judul-dashboard">
                <div class="judul-dashboard">
                    <h2>Dashboard Repository</h2>
                    <p>Mode debug aktif - Menampilkan struktur data asli</p>
                </div>
                <div class="kontrol">
                    <button class="tombol tombol-primer" id="tombolRefresh">
                        <i class="fas fa-sync-alt"></i>
                        <span>Muat Ulang Data</span>
                    </button>
                    <button class="tombol tombol-sekunder" id="tombolDataMock">
                        <i class="fas fa-database"></i>
                        <span>Data Contoh</span>
                    </button>
                    <button class="tombol" id="tombolDebug" style="background-color: #6f42c1; color: white;">
                        <i class="fas fa-bug"></i>
                        <span>Debug Data</span>
                    </button>
                </div>
            </div>
            
            <!-- Area Pesan -->
            <div id="areaPesan"></div>
            
            <!-- Debug Panel (Awalnya tersembunyi) -->
            <div class="debug-panel" id="debugPanel" style="display: none;">
                <div class="debug-header">
                    <h3><i class="fas fa-bug"></i> Struktur Data Debug</h3>
                    <button class="debug-toggle" id="toggleDebug">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="debug-content" id="debugContent">
                    <p>Memuat data debug...</p>
                </div>
            </div>
            
            <div class="kontainer-statistik" id="kontainerStatistik">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat statistik...</p>
                </div>
            </div>
            
            <div class="kontainer-data">
                <div class="header-tabel">
                    <h3>Detail Repository</h3>
                    <div class="info-tabel" id="infoTabel">
                        <span id="jumlahRepo">Memuat...</span> repository ditemukan
                    </div>
                </div>
                <div class="wrapper-tabel">
                    <table class="tabel-data">
                        <thead>
                            <tr>
                                <th>Nama Repository</th>
                                <th>Deskripsi</th>
                                <th>Bahasa</th>
                                <th>Bintang</th>
                                <th>Fork</th>
                                <th>Terakhir Diperbarui</th>
                                <th>Visibilitas</th>
                            </tr>
                        </thead>
                        <tbody id="bodyTabel">
                            <tr>
                                <td colspan="7">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>Memuat data repository...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="sumber-data">
                <h4>Informasi Sumber Data</h4>
                <p>Dashboard ini mengambil data dari endpoint Google Apps Script Anda. Klik tombol "Debug Data" untuk melihat struktur data asli.</p>
                <div class="url-endpoint">
                    https://script.google.com/macros/s/AKfycbwMV8Q3eJ9g0xdbTgRyb0a0sRCRmfu1qx6iOjujXu3IUehoYIiD8aC87KceaF0qNJdfSg/exec
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="kontainer footer-konten">
            <div class="link-footer">
                <a href="https://github.com" target="_blank">GitHub</a>
                <a href="https://docs.github.com" target="_blank">Dokumentasi</a>
                <a href="https://developer.github.com" target="_blank">API</a>
            </div>
            <div class="hak-cipta">
                &copy; 2023 Penampil Data GitHub | Mode Debug Aktif
            </div>
        </div>
    </footer>
    
    <script>
        // URL endpoint Google Apps Script Anda
        const URL_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwMV8Q3eJ9g0xdbTgRyb0a0sRCRmfu1qx6iOjujXu3IUehoYIiD8aC87KceaF0qNJdfSg/exec';
        
        // Elemen DOM
        const kontainerStatistik = document.getElementById('kontainerStatistik');
        const bodyTabel = document.getElementById('bodyTabel');
        const jumlahRepo = document.getElementById('jumlahRepo');
        const tombolRefresh = document.getElementById('tombolRefresh');
        const tombolDataMock = document.getElementById('tombolDataMock');
        const tombolDebug = document.getElementById('tombolDebug');
        const areaPesan = document.getElementById('areaPesan');
        const debugPanel = document.getElementById('debugPanel');
        const debugContent = document.getElementById('debugContent');
        const toggleDebug = document.getElementById('toggleDebug');
        
        // Data contoh untuk demonstrasi
        const dataContoh = {
            statistik: {
                totalRepo: 8,
                totalBintang: 245,
                totalFork: 78,
                bahasa: 5
            },
            repository: [
                {
                    nama: "dashboard-web",
                    deskripsi: "Dashboard web responsif untuk visualisasi data",
                    bahasa: "JavaScript",
                    bintang: 45,
                    fork: 12,
                    terakhirDiperbarui: "2023-10-15",
                    privat: false
                }
                // ... data lainnya sama seperti sebelumnya
            ]
        };
        
        // ==================== FUNGSI DEBUG ====================
        
        // Tampilkan pesan
        function tampilkanPesan(teks, tipe) {
            const kelas = tipe === 'sukses' ? 'pesan-sukses' : 
                         tipe === 'error' ? 'pesan-error' : 'pesan-info';
            
            const pesanHTML = `
                <div class="pesan ${kelas}">
                    <i class="fas fa-${tipe === 'sukses' ? 'check-circle' : tipe === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${teks}</span>
                </div>
            `;
            
            areaPesan.innerHTML = pesanHTML;
            
            setTimeout(() => {
                areaPesan.innerHTML = '';
            }, 5000);
        }
        
        // Fungsi debug utama
        async function debugStrukturData() {
            try {
                tampilkanPesan('Sedang menganalisis struktur data...', 'info');
                
                const response = await fetch(URL_ENDPOINT);
                const data = await response.json();
                
                console.log("STRUKTUR DATA ASLI:", data);
                
                // Analisis struktur data
                const analysis = analisisStrukturData(data);
                
                // Tampilkan hasil debug
                tampilkanHasilDebug(data, analysis);
                
                tampilkanPesan('Analisis struktur data selesai!', 'sukses');
                
                return { data, analysis };
                
            } catch (error) {
                console.error("Gagal debug:", error);
                tampilkanPesan(`Error debug: ${error.message}`, 'error');
                
                // Tampilkan error di panel debug
                debugContent.innerHTML = `
                    <div style="color: #dc3545;">
                        <h4><i class="fas fa-exclamation-triangle"></i> Error Debug</h4>
                        <p><strong>Pesan Error:</strong> ${error.message}</p>
                        <p><strong>Kemungkinan penyebab:</strong></p>
                        <ul>
                            <li>CORS restrictions</li>
                            <li>Endpoint tidak merespon</li>
                            <li>Format data tidak valid</li>
                        </ul>
                        <p>Periksa console browser (F12) untuk detail error.</p>
                    </div>
                `;
                
                debugPanel.style.display = 'block';
                return null;
            }
        }
        
        // Analisis struktur data
        function analisisStrukturData(data) {
            const analysis = {
                tipeData: Array.isArray(data) ? 'Array' : 'Object',
                totalKeys: Object.keys(data).length,
                isArray: Array.isArray(data),
                arrayLength: Array.isArray(data) ? data.length : null,
                sampleItem: null,
                nestedArrays: [],
                potentialRepoData: []
            };
            
            // Jika data adalah array
            if (Array.isArray(data) && data.length > 0) {
                analysis.sampleItem = data[0];
                analysis.potentialRepoData = data;
            }
            // Jika data adalah object
            else if (typeof data === 'object' && data !== null) {
                // Cari array di dalam object
                for (const key in data) {
                    if (Array.isArray(data[key])) {
                        analysis.nestedArrays.push({
                            key: key,
                            length: data[key].length,
                            sample: data[key][0]
                        });
                        
                        // Jika array ini terlihat seperti data repo
                        if (data[key].length > 0 && data[key][0].nama !== undefined) {
                            analysis.potentialRepoData = data[key];
                        }
                    }
                }
                
                // Ambil sample dari nested array pertama
                if (analysis.nestedArrays.length > 0) {
                    analysis.sampleItem = analysis.nestedArrays[0].sample;
                }
            }
            
            return analysis;
        }
        
        // Tampilkan hasil debug
        function tampilkanHasilDebug(data, analysis) {
            let debugHTML = `
                <div class="data-info">
                    <div class="info-item">
                        <div class="info-label">Tipe Data</div>
                        <div>${analysis.tipeData}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Total Keys</div>
                        <div>${analysis.totalKeys}</div>
                    </div>
            `;
            
            if (analysis.isArray) {
                debugHTML += `
                    <div class="info-item">
                        <div class="info-label">Panjang Array</div>
                        <div>${analysis.arrayLength}</div>
                    </div>
                `;
            }
            
            debugHTML += `
                </div>
                <h4>Data Mentah (JSON):</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
            if (analysis.sampleItem) {
                debugHTML += `
                    <h4>Contoh Item Pertama:</h4>
                    <pre>${JSON.stringify(analysis.sampleItem, null, 2)}</pre>
                    
                    <h4>Keys yang tersedia:</h4>
                    <ul style="background: #e9ecef; padding: 15px; border-radius: 5px;">
                        ${Object.keys(analysis.sampleItem).map(key => 
                            `<li><strong>${key}:</strong> ${typeof analysis.sampleItem[key]} (${JSON.stringify(analysis.sampleItem[key])})</li>`
                        ).join('')}
                    </ul>
                `;
            }
            
            if (analysis.nestedArrays.length > 0) {
                debugHTML += `
                    <h4>Array yang Ditemukan:</h4>
                    <ul>
                        ${analysis.nestedArrays.map(arr => 
                            `<li><strong>${arr.key}:</strong> Array dengan ${arr.length} item</li>`
                        ).join('')}
                    </ul>
                `;
            }
            
            debugContent.innerHTML = debugHTML;
            debugPanel.style.display = 'block';
        }
        
        // ==================== FUNGSI UTAMA ====================
        
        // Format tanggal
        function formatTanggal(stringTanggal) {
            try {
                const opsi = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(stringTanggal).toLocaleDateString('id-ID', opsi);
            } catch {
                return stringTanggal;
            }
        }
        
        // Render statistik
        function renderStatistik(statistik) {
            const htmlStatistik = `
                <div class="kartu-statistik">
                    <div class="info-statistik">
                        <h3>Total Repository</h3>
                        <div class="nilai-statistik">${statistik.totalRepo}</div>
                    </div>
                    <div class="ikon-statistik">
                        <i class="fas fa-code-branch"></i>
                    </div>
                </div>
                <div class="kartu-statistik">
                    <div class="info-statistik">
                        <h3>Total Bintang</h3>
                        <div class="nilai-statistik">${statistik.totalBintang}</div>
                    </div>
                    <div class="ikon-statistik">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div class="kartu-statistik">
                    <div class="info-statistik">
                        <h3>Total Fork</h3>
                        <div class="nilai-statistik">${statistik.totalFork}</div>
                    </div>
                    <div class="ikon-statistik">
                        <i class="fas fa-code-fork"></i>
                    </div>
                </div>
                <div class="kartu-statistik">
                    <div class="info-statistik">
                        <h3>Bahasa yang Digunakan</h3>
                        <div class="nilai-statistik">${statistik.bahasa}</div>
                    </div>
                    <div class="ikon-statistik">
                        <i class="fas fa-language"></i>
                    </div>
                </div>
            `;
            
            kontainerStatistik.innerHTML = htmlStatistik;
        }
        
        // Render tabel
        function renderTabel(repository) {
            jumlahRepo.textContent = repository.length;
            
            if (repository.length === 0) {
                bodyTabel.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 3rem;">
                            <i class="fas fa-database" style="font-size: 3rem; color: #e1e4e8; margin-bottom: 1rem;"></i>
                            <p>Tidak ada data repository</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let htmlTabel = '';
            
            repository.forEach(repo => {
                htmlTabel += `
                    <tr>
                        <td>
                            <a href="#" class="nama-repo">
                                ${repo.nama || repo.name || 'N/A'}
                            </a>
                        </td>
                        <td>${repo.deskripsi || repo.description || 'Tidak ada deskripsi'}</td>
                        <td>${repo.bahasa || repo.language || 'N/A'}</td>
                        <td><strong>${repo.bintang || repo.stars || repo.stargazers_count || 0}</strong></td>
                        <td>${repo.fork || repo.forks || repo.forks_count || 0}</td>
                        <td>${formatTanggal(repo.terakhirDiperbarui || repo.updated_at || repo.last_updated)}</td>
                        <td>
                            <span class="label ${(repo.privat || repo.private) ? 'label-privat' : 'label-publik'}">
                                ${(repo.privat || repo.private) ? 'Privat' : 'Publik'}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            bodyTabel.innerHTML = htmlTabel;
        }
        
        // Muat data contoh
        function muatDataContoh() {
            kontainerStatistik.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat data contoh...</p>
                </div>
            `;
            
            bodyTabel.innerHTML = `
                <tr>
                    <td colspan="7">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Memuat data contoh...</p>
                        </div>
                    </td>
                </tr>
            `;
            
            setTimeout(() => {
                renderStatistik(dataContoh.statistik);
                renderTabel(dataContoh.repository);
                tampilkanPesan('Data contoh berhasil dimuat!', 'sukses');
            }, 800);
        }
        
        // Muat data asli
        async function muatDataAsli() {
            kontainerStatistik.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat data dari endpoint...</p>
                </div>
            `;
            
            bodyTabel.innerHTML = `
                <tr>
                    <td colspan="7">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Memuat data dari endpoint...</p>
                        </div>
                    </td>
                </tr>
            `;
            
            try {
                tampilkanPesan('Mengambil data dari endpoint...', 'info');
                
                const response = await fetch(URL_ENDPOINT);
                const data = await response.json();
                
                console.log("Data diterima:", data);
                
                // Coba ekstrak data repository dari berbagai struktur
                let repository = [];
                let statistik = {};
                
                // Analisis otomatis struktur data
                const analysis = analisisStrukturData(data);
                
                // Tentukan data repository
                if (analysis.potentialRepoData.length > 0) {
                    repository = analysis.potentialRepoData;
                } else if (analysis.isArray) {
                    repository = data;
                } else if (analysis.nestedArrays.length > 0) {
                    repository = data[analysis.nestedArrays[0].key] || [];
                }
                
                // Hitung statistik
                statistik = {
                    totalRepo: repository.length,
                    totalBintang: repository.reduce((sum, repo) => sum + (repo.bintang || repo.stars || repo.stargazers_count || 0), 0),
                    totalFork: repository.reduce((sum, repo) => sum + (repo.fork || repo.forks || repo.forks_count || 0), 0),
                    bahasa: new Set(repository.map(repo => repo.bahasa || repo.language).filter(Boolean)).size
                };
                
                // Render data
                renderStatistik(statistik);
                renderTabel(repository);
                tampilkanPesan(`Berhasil memuat ${repository.length} repository!`, 'sukses');
                
            } catch (error) {
                console.error("Error:", error);
                tampilkanPesan(`Gagal: ${error.message}. Menggunakan data contoh...`, 'error');
                setTimeout(muatDataContoh, 1500);
            }
        }
        
        // ==================== EVENT LISTENERS ====================
        
        tombolRefresh.addEventListener('click', muatDataAsli);
        tombolDataMock.addEventListener('click', muatDataContoh);
        
        tombolDebug.addEventListener('click', async () => {
            await debugStrukturData();
        });
        
        toggleDebug.addEventListener('click', () => {
            debugPanel.style.display = 'none';
        });
        
        areaPesan.addEventListener('click', function() {
            this.innerHTML = '';
        });
        
        // ==================== INISIALISASI ====================
        
        // Inisialisasi dashboard
        async function inisialisasiDashboard() {
            // Coba muat data asli
            await muatDataAsli();
            
            // Otomatis jalankan debug untuk analisis
            setTimeout(async () => {
                await debugStrukturData();
            }, 1000);
        }
        
        // Jalankan saat halaman dimuat
        document.addEventListener('DOMContentLoaded', inisialisasiDashboard);
    </script>
</body>
</html>
